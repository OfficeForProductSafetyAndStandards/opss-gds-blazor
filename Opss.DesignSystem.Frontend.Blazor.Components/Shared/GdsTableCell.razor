@inherits GdsWithContent

@if(isHeaderCell || isHeaderRow)
{
    <th scope=@scope
        colspan=@ColSpan
        rowspan=@RowSpan
        class=@classes(TableClasses.HeaderCell)
        @attributes=@Attributes        
    >
        @ChildContent
    </th>
}
else
{
    <td colspan=@ColSpan
        rowspan=@RowSpan
        class=@classes(TableClasses.Cell)
        @attributes=@Attributes
    >
        @ChildContent
    </td>
}

@code {
    #region Public Parameters
    /// <summary>
    /// Specifies how many rows a cell extends.
    /// </summary>
    [Parameter]
    public int? RowSpan { get; set; }

    /// <summary>
    /// Specifies how many columns a cell extends.
    /// </summary>
    [Parameter]
    public int? ColSpan { get; set; }

    /// <summary>
    /// Specify format of a cell. Currently only “numeric” is in use.
    /// </summary>
    [Parameter]
    public string? Format { get; set; }
    #endregion

    #region Private Properties
    /// <summary>
    /// Indicates the cell is the first, and a header, in the containing parent <see cref="GdsTableRow"/>.
    /// </summary>
    private bool isHeaderCell;

    /// <summary>
    /// Indicates the parent is a <see cref="GdsTable"/> component, and is therefore a cell in a table head row.
    /// This parameter is set automatically when this component is nested inside a <seealso cref="GdsTable.HeadTemplate"/>.
    /// </summary>
    private bool isHeaderRow;

    private string? scope
    {
        get
        {
            if (isHeaderRow) return TableScopes.Col;
            if (isHeaderCell) return TableScopes.Row;
            return null;
        }
    }

    private bool isNumeric => Format == TableCellFormat.Numeric;

    private string classes(string initialClass)
    {
        var classBuilder = initialClass;

        if (isNumeric)
        {
            classBuilder += 
                (isHeaderCell || isHeaderRow)
                    ? $" {TableClasses.NumericHeaderCell}"
                    : $" {TableClasses.NumericCell}";
        }

        if (!string.IsNullOrWhiteSpace(base.Classes))
            classBuilder += $" {base.Classes}";

        return classBuilder;
    }
    #endregion

    #region Cascading Value - Parent(s)
    protected override void OnInitialized()
    {
        if (ParentRow == null && ParentTable == null)
            throw new ArgumentNullException($"{nameof(ParentRow)} or {nameof(ParentTable)}", "GdsTableCell must exist within a GdsTable or a GdsTableRow");

        isHeaderCell = ParentRow?.FirstCellIsHeader ?? false;
        isHeaderRow = ParentTable != null;

        if (RowSpan <= 1) RowSpan = null;
        if (ColSpan <= 1) ColSpan = null;

        base.OnInitialized();
        ParentRow?.ClearFirstCellIsHeaderFlag(this);
    }

    [CascadingParameter(Name = "ParentRow")]
    private GdsTableRow? ParentRow { get; set; }

    [CascadingParameter(Name = "ParentTable")]
    private GdsTable? ParentTable { get; set; }
    #endregion
}
