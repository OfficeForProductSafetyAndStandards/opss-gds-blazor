@inherits GdsViewModel

@* <summary>
    Use the date input component to help users enter a memorable date or one 
    they can easily look up.
</summary> *@

<div class=@classes>
    <GdsFieldset Role="group"
                 DescribedBy=@describedBy?.Trim()
    >
        <LegendTemplate>
            @LegendTemplate
        </LegendTemplate>
        <ChildContent>
            @if (HintTemplate != null)
            {
                <CascadingValue Value=@Id>
                    @HintTemplate
                </CascadingValue>
            }
            @if (ErrorMessageTemplate != null)
            {
                <CascadingValue Value=@Id>
                    @ErrorMessageTemplate
                </CascadingValue>
            }

            <div id=@Id
                 class="govuk-date-input">
                @if (BeforeInputTemplate != null)
                {
                    @BeforeInputTemplate
                }
                <CascadingValue Value=this>
                    @DateInputFields
                </CascadingValue>
                @if (AfterInputTemplate != null)
                {
                    @AfterInputTemplate
                }
            </div>
        </ChildContent>
    </GdsFieldset>
</div>

@code {
    #region Public Parameters
    /// <summary>
    /// A collection of DateInputFields to collect each date part.
    /// </summary>
    [Parameter]
    public RenderFragment? DateInputFields { get; set; }

    /// <summary>
    /// The legend for the fieldset component.
    /// </summary>
    [Parameter]
    public RenderFragment? LegendTemplate { get; set; }

    /// <summary>
    /// Can be used to add a hint to the date input component.
    /// </summary>
    [Parameter]
    public RenderFragment? HintTemplate { get; set; }

    /// <summary>
    /// Can be used to add an error message to the date input component.
    /// </summary>
    [Parameter]
    public RenderFragment? ErrorMessageTemplate { get; set; }

    /// <summary>
    /// Content to add before the textarea used by the date input component.
    /// </summary>
    [Parameter]
    public RenderFragment? BeforeInputTemplate { get; set; }

    /// <summary>
    /// Content to add after the textarea used by the date input component.
    /// </summary>
    [Parameter]
    public RenderFragment? AfterInputTemplate { get; set; }

    /// <summary>
    /// Optional prefix. This is used to prefix each item name, separated by -.
    /// </summary>
    [Parameter]
    public string? NamePrefix { get; set; }

    /// <summary>
    /// Classes to add to the form group (for example to show error state for the whole group).
    /// </summary>
    [Parameter]
    public string? FormGroupClasses { get; set; }
    #endregion

    #region Private Properties
    private string? describedBy
    {
        get
        {
            var describedBy = new List<string>();

            if (HintTemplate != null)
                describedBy.Add(Id + "-hint");
            if (ErrorMessageTemplate != null)
                describedBy.Add(Id + "-error");

            if (describedBy.Any())
                return string.Join(" ", describedBy);
            else
                return null;
        }
    }

    private string classes
    {
        get
        {
            var classBuilder = "govuk-form-group";
            if (Classes != null)
                classBuilder += $" {Classes}";
            if (ErrorMessageTemplate != null)
                classBuilder += " govuk-form-group--error";
            return classBuilder;
        }
    }
    #endregion
}